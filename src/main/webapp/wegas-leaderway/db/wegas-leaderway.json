{
    "@class": "GameModel",
    "name": "Leaderway",
    "cssUri": "wegas-leaderway/css/wegas-leaderway.css",
    "widgetsUri": "wegas-leaderway/db/wegas-leaderway-pages.json",
    "games":[{
            "@class":"Game",
            "name":"Test-16",
            "teams":[{
                    "@class": "Team",
                    "name":"Les autres",
                    "players": [ {
                            "@class": "Player",
                            "name": "Jo",
                            "user": {
                                "@class": "User",
                                "name": "Jean"
                            }
                        }]
                }]
        }],
    "childVariableDescriptors": [{
            "@class": "NumberDescriptor",
            "name": "budget",
            "defaultVariableInstance": {
                "@class": "NumberInstance",
                "value":"30000"
            },
            "scope": {
                "@class": "TeamScope"
            }
        },{
            "@class": "NumberDescriptor",
            "name": "actions",
            "defaultVariableInstance": {
                "@class": "NumberInstance",
                "value":"10"
            },
            "scope": {
                "@class": "TeamScope"
            }
        },{
            "@class": "NumberDescriptor",
            "name": "week",
            "minValue": 1,
            "maxValue": 10,
            "defaultVariableInstance": {
                "@class": "NumberInstance",
                "value":"1"
            },
            "scope": {
                "@class": "TeamScope"
            }
        },{
            "@class": "NumberDescriptor",
            "name": "teamMotivation",
            "minValue": 0,
            "maxValue": 100,
            "defaultVariableInstance": {
                "@class": "NumberInstance",
                "value":"67"
            },
            "scope": {
                "@class": "TeamScope"
            }
        },{
            "@class": "NumberDescriptor",
            "name": "clientsSatisfaction",
            "minValue": 0,
            "maxValue": 100,
            "defaultVariableInstance": {
                "@class": "NumberInstance",
                "value":"54"
            },
            "scope": {
                "@class": "TeamScope"
            }
        },{
            "@class": "InboxDescriptor",
            "name": "inbox",
            "defaultVariableInstance": {
                "@class": "InboxInstance"
            },
            "scope": {
                "@class": "PlayerScope"
            }
        },{
            "@class": "ListDescriptor",
            "name": "resources",
            "items":[{
                    "@class": "ResourceDescriptor",
                    "name": "Salmero",
                    "description":"Test de description.",
                    "defaultVariableInstance":{
                        "@class":"ResourceInstance",
                        "moral":72,
                        "confidence":27,
                        "properties":{
                            "picture":"http://localhost:8080/Wegas/rest/File/GameModelId/1/read/portraitFernand.png",
                            "surname":"Fernand",
                            "male":true,
                            "salary":4000,
                            "leadershipLevel":1,
                            "lastWorkQuality":70,
                            "wish":"",
                            "hate":"",
                            "frankness":90,
                            "numberOfWorkWithLeader":0,
                            "totalExperienceGained":0,
                            "learningCoefficient":0.7,
                            "dialogue":""
                        },
                        "skillset":{
                            "Design graphique":15,
                            "Développement de base de données":32,
                            "Développement logiciel":26,
                            "Langages Web":29,
                            "Modélisation des traitements":44,
                            "Negociation": 84
                        }
                    },
                    "scope": {
                        "@class": "TeamScope"
                    }
                },{
                    "@class": "ResourceDescriptor",
                    "name": "Brossard",
                    "description":"Test de description.",
                    "defaultVariableInstance":{
                        "@class":"ResourceInstance",
                        "moral":45,
                        "confidence":30,
                        "properties":{
                            "picture":"http://localhost:8080/Wegas/rest/File/GameModelId/1/read/portraitDaniela.png",
                            "surname":"Daniela",
                            "male":false,
                            "salary":3800,
                            "leadershipLevel":1,
                            "lastWorkQuality":48,
                            "wish":"",
                            "hate":"",
                            "frankness":65,
                            "numberOfWorkWithLeader":0,
                            "totalExperienceGained":0,
                            "learningCoefficient":0.6,
                            "dialogue":""
                        },
                        "skillset":{
                            "Design graphique":84,
                            "Développement de base de données":24,
                            "Développement logiciel":5,
                            "Langages Web":44,
                            "Modélisation des traitements":19,
                            "Negociation": 60
                        }
                    },
                    "scope": {
                        "@class": "TeamScope"
                    }
                },{
                    "@class": "ResourceDescriptor",
                    "name": "Vogt",
                    "description":"Test de description.",
                    "defaultVariableInstance":{
                        "@class":"ResourceInstance",
                        "moral":50,
                        "confidence":34,
                        "properties":{
                            "picture":"http://localhost:8080/Wegas/rest/File/GameModelId/1/read/portraitJessica.png",
                            "surname":"Jessica",
                            "male":false,
                            "salary":3300,
                            "leadershipLevel":1,
                            "lastWorkQuality":52,
                            "wish":"",
                            "hate":"",
                            "frankness":66,
                            "numberOfWorkWithLeader":0,
                            "totalExperienceGained":0,
                            "learningCoefficient":1,
                            "dialogue":""
                        },
                        "skillset":{
                            "Design graphique":12,
                            "Développement de base de données":49,
                            "Développement logiciel":31,
                            "Langages Web":67,
                            "Modélisation des traitements":38,
                            "Negociation": 8
                        }
                    },
                    "scope": {
                        "@class": "TeamScope"
                    }
                },{
                    "@class": "ResourceDescriptor",
                    "name": "Auguste",
                    "description":"sans description",
                    "defaultVariableInstance":{
                        "@class":"ResourceInstance",
                        "moral":85,
                        "confidence":37,
                        "properties":{
                            "picture":"http://localhost:8080/Wegas/rest/File/GameModelId/53/read/portraitHector.png",
                            "surname":"Hector",
                            "male":true,
                            "salary":3400,
                            "leadershipLevel":1,
                            "lastWorkQuality":89,
                            "wish":"",
                            "hate":"",
                            "frankness":80,
                            "numberOfWorkWithLeader":0, 
                            "totalExperienceGained":0,
                            "learningCoefficient":1.2,
                            "dialogue":""
                        },
                        "skillset":{
                            "Design graphique":4,
                            "Développement de base de données":34,
                            "Développement logiciel":64,
                            "Langages Web":40,
                            "Modélisation des traitements":65,
                            "Negociation": 2
                        }
                    },
                    "scope": {
                        "@class": "TeamScope"
                    }
                },{
                    "@class": "ResourceDescriptor",
                    "name": "Torr",
                    "description":"Description du personnage",
                    "defaultVariableInstance":{
                        "@class":"ResourceInstance",
                        "moral":50,
                        "confidence":9,
                        "properties":{
                            "picture":"http://localhost:8080/Wegas/rest/File/GameModelId/1/read/portraitLucien.png",
                            "surname":"Lucien",
                            "male":true,
                            "salary":3500,
                            "leadershipLevel":1,
                            "lastWorkQuality":66,
                            "wish":"",
                            "hate":"",
                            "frankness":10,
                            "numberOfWorkWithLeader":0,
                            "totalExperienceGained":0,
                            "learningCoefficient":1,
                            "dialogue":"dialogueLucien"
                        },
                        "skillset":{
                            "Design graphique":12,
                            "Développement de base de données":72,
                            "Développement logiciel":25,
                            "Langages Web":26,
                            "Modélisation des traitements":34,
                            "Negociation": 45
                        }
                    },
                    "scope": {
                        "@class": "TeamScope"
                    }
                }],
            "defaultVariableInstance":{
                "@class": "NumberInstance",
                "value": 0
            },
            "scope": {
                "@class": "GameModelScope"
            }
        },{
            "@class": "ListDescriptor",
            "name": "tasks",
            "items":[{
                    "@class": "TaskDescriptor",
                    "name": "Création d'une maquette pour un logiciel.",
                    "description":"",
                    "defaultVariableInstance":{
                        "@class":"TaskInstance",
                        "duration":1,
                        "properties":{
                            "salary":1500,
                            "bonus":0,
                            "workQualityMinForBonus":0,
                            "comment":"",
                            "clientSatisfactionMinToAppear":0,
                            "clientSatisfactionMaxToAppear":100,
                            "appearAtWeek":1,
                            "disappearAtWeek":2,
                            "workWithLeader": false
                        },
                        "skillset":{
                            "Design graphique":50
                        }
                    },
                    "scope": {
                        "@class": "TeamScope"
                    }
                },{
                    "@class": "TaskDescriptor",
                    "name": "Création d'un cahier des charges pour un CMS",
                    "description":"",
                    "defaultVariableInstance":{
                        "@class":"TaskInstance",
                        "duration":1,
                        "properties":{
                            "salary":1100,
                            "bonus":3000,
                            "workQualityMinForBonus":10,
                            "comment":"",
                            "clientSatisfactionMinToAppear":0,
                            "clientSatisfactionMaxToAppear":60,
                            "appearAtWeek":2,
                            "disappearAtWeek":5,
                            "workWithLeader": false
                        },
                        "skillset":{
                            "Négociation":30
                        }
                    },
                    "scope": {
                        "@class": "TeamScope"
                    }
                },{
                    "@class": "TaskDescriptor",
                    "name": "Migration d'une base de données MySQL vers une base de données PostgreSQL",
                    "description":"",
                    "defaultVariableInstance":{
                        "@class":"TaskInstance",
                        "duration":3,
                        "properties":{
                            "salary":3600,
                            "bonus":0,
                            "workQualityMinForBonus":0,
                            "comment":"",
                            "clientSatisfactionMinToAppear":40,
                            "clientSatisfactionMaxToAppear":100,
                            "appearAtWeek":2,
                            "disappearAtWeek":4,
                            "workWithLeader": false
                        },
                        "skillset":{
                            "Dévellopement de base de données":55
                        }
                    },
                    "scope": {
                        "@class": "TeamScope"
                    }
                },{
                    "@class": "TaskDescriptor",
                    "name": "Modélisation des traitement d'un logiciel",
                    "description":"",
                    "defaultVariableInstance":{
                        "@class":"TaskInstance",
                        "duration":4,
                        "properties":{
                            "salary":5700,
                            "bonus":1000,
                            "workQualityMinForBonus":80,
                            "comment":"",
                            "clientSatisfactionMinToAppear":70,
                            "clientSatisfactionMaxToAppear":100,
                            "appearAtWeek":1,
                            "disappearAtWeek":4,
                            "workWithLeader": true
                        },
                        "skillset":{
                            "Modelisation des traitements":70
                        }
                    },
                    "scope": {
                        "@class": "TeamScope"
                    }
                },{
                    "@class": "TaskDescriptor",
                    "name": "Création d’une base de données.",
                    "description":"",
                    "defaultVariableInstance":{
                        "@class":"TaskInstance",
                        "duration":2,
                        "properties":{
                            "salary":3000,
                            "workQualityMinForBonus":80,
                            "bonus":0,
                            "comment":"",
                            "clientSatisfactionMinToAppear":0,
                            "clientSatisfactionMaxToAppear":100,
                            "appearAtWeek":1,
                            "disappearAtWeek":3,
                            "workWithLeader": true
                        },
                        "skillset":{
                            "Développement de base de données":43
                        }
                    },
                    "scope": {
                        "@class": "TeamScope"
                    }
                }],
            "defaultVariableInstance":{
                "@class": "NumberInstance",
                "value": 0
            },
            "scope": {
                "@class": "GameModelScope"
            }
        },{
            "@class": "ListDescriptor",
            "name": "absences",
            "items":[{
                    "@class": "TaskDescriptor",
                    "name": "sickness",
                    "description":"",
                    "defaultVariableInstance":{
                        "@class":"TaskInstance",
                        "duration":1
                    },
                    "scope": {
                        "@class": "TeamScope"
                    }
                }],
            "defaultVariableInstance":{
                "@class": "NumberInstance",
                "value": 0
            },
            "scope": {
                "@class": "GameModelScope"
            }
        },
        {
            "@class" : "DialogueDescriptor",
            "name" : "dialogueLucien",
            "defaultVariableInstance" : {
                "@class" : "FSMInstance",
                "currentStateId" : 1
            },
            "scope" : {
                "@class" : "TeamScope"
            },
            "states" : {
                "1" : {
                    "@class" : "DialogueState",
                    "text" : "{\"speakerName\":\"Lucien\",\"texts\":[\"Texte aléatoire 1 : Bonjours, je suis là pour vous présenter un long texte. Les problèmes liés à mon apparence sont dû à deux choses : la compression de mon sprite ainsi que le fait que mon designer ne m'a pas finit, je ne suis qu'une esquisse de moi-même.\",\"Texte aléatoire 2 : Salut, je suis là pour vous présenter un long texte. Les problèmes liés à mon apparence sont dû à deux choses : la compression de mon sprite ainsi que le fait que mon designer ne m'a pas finit, je ne suis qu'une esquisse de moi-même.\",\"Texte aléatoire 3 : Ciao, je suis là pour vous présenter un long texte. Les problèmes liés à mon apparence sont dû à deux choses : la compression de mon sprite ainsi que le fait que mon designer ne m'a pas finit, je ne suis qu'une esquisse de moi-même.\"],\"backgroundImages\":[{\"link\":\"http://image.noelshack.com/fichiers/2012/30/1343217993-background.jpg\",\"height\":\"315px\",\"width\":\"980px\",\"css\": {}}],\"questionImages\":[{\"link\":\"http://image.noelshack.com/fichiers/2012/30/1343227926-persofache.gif\",\"height\":\"250px\",\"width\":\"230px\",\"css\": {\"margin\":\"50px 0 0 375px\"}}],\"answerImages\":[{\"link\":\"http://image.noelshack.com/fichiers/2012/30/1343228117-persofache.png\",\"height\":\"250px\",\"width\":\"230px\",\"css\": {\"margin\":\"50px 0 0 375px\"}}]}",
                    "transitions" : [{
                            "@class" : "DialogueTransition",
                            "actionText" : "Si je fais ça, je vais dans l'état 2",
                            "nextStateId" : 2,
                            "triggerCondition" : {
                                "@class" : "Script",
                                "content" : "C'est possible d'avoir un script aussi ...",
                                "language" : "JavaScript"
                            },
                            "preStateImpact" : {
                                "@class" : "Script",
                                "content" : "Un script exécuté au passage de la transition (n'est pour le moment pas évalué)",
                                "language" : "JavaScript"
                            }
                        }
                    ]
                },
                "2" : {
                    "@class" : "DialogueState",
                    "text":"{\"speakerName\":\"Lucien\",\"texts\":\"Mon dialogue s'arrête ici. Y a plus rien à voir pour l'instant.\",\"backgroundImages\":[{\"link\":\"http://image.noelshack.com/fichiers/2012/30/1343217993-background.jpg\",\"height\":\"315px\",\"width\":\"980px\",\"css\": {}}],\"questionImages\":[{\"link\":\"http://image.noelshack.com/fichiers/2012/30/1343227926-persofache.gif\",\"height\":\"250px\",\"width\":\"230px\",\"css\": {\"margin\":\"50px 0 0 375px\"}}],\"answerImages\":[{\"link\":\"http://image.noelshack.com/fichiers/2012/30/1343228117-persofache.png\",\"height\":\"250px\",\"width\":\"230px\",\"css\": {\"margin\":\"50px 0 0 375px\"}}]}",
                    "transitions" : [],
                    "onEnterEvent" : {
                        "@class" : "Script",
                        "content" : "VariableDescriptorFacade.findByName(self.getGameModel(), 'resources').items.get(0).getInstance(self).setMoral(30);",
                        "language" : "JavaScript"
                    }
                }
            }
        }
    ],
    "scriptLibrary": {
    "default":"function finishCurrentWeek(){var a=self.getGameModel(),b=VariableDescriptorFacade.findByName(a,'week'),c=b.getInstance(self);if(c.getValue()<b.getMaxValue()){c.setValue(c.getValue()+1);this.checkTasksEnd();this.checkAbsencesEnd();this.removeDeactivatedAssignements();this.checkTasksState();this.payResources();this.checkMoral();this.checkLeadershipLevel();this.sendScore()}}function getValideResources(){var a,b,c,d=self.getGameModel(),e=new Array,f=false,g=VariableDescriptorFacade.findByName(d,'resources'),h,i,j=VariableDescriptorFacade.findByName(d,'absences'),k,l;for(a=0;a<g.items.size();a++){h=g.items.get(a);i=h.getInstance(self);f=false;if(i.getActive()==true){f=true;for(b=0;b<i.getAssignments().size();b++){l=i.getAssignments().get(b);for(c=0;c<j.items.size();c++){k=j.items.get(c).getInstance(self);if(l.getTaskDescriptorId()==k.getDescriptorId()&&k.getActive()==true){f=false}}}}if(f)e.push(h)}return e}function getWorkedTasks(a){var b,c,d,e=self.getGameModel(),f=new Array,g=false,h,i,j=VariableDescriptorFacade.findByName(e,'tasks'),k,l;for(b=0;b<j.items.size();b++){k=j.items.get(b);l=k.getInstance(self);g=false;if(l.getActive()==true){for(c=0;c<a.length;c++){i=a[c].getInstance(self);for(d=0;d<i.getAssignments().size();d++){h=i.getAssignments().get(d);if(h.getTaskDescriptorId()==l.getDescriptorId()){g=true}}}}if(g)f.push(k)}return f}function checkTasksEnd(){var a,b,c,d,e=new Array,f=this.getValideResources(),g,h=this.getWorkedTasks(f),i;for(a=0;a<h.length;a++){e.length=0;i=h[a].getInstance(self);for(b=0;b<f.length;b++){g=f[b].getInstance(self);for(c=0;c<g.getAssignments().size();c++){d=g.getAssignments().get(c);if(d.getTaskDescriptorId()==i.getDescriptorId()){e.push(f[b])}}}i.setDuration(i.getDuration()-e.length);if(i.getDuration()<=0){this.doTaskEnd(e,h[a])}}}function doTaskEnd(a,b){if(a.length<=0||b==null)return;var c,d,e=self.getGameModel(),f,g=b.getInstance(self),h=VariableDescriptorFacade.findByName(e,'budget').getInstance(self),i=VariableDescriptorFacade.findByName(e,'clientsSatisfaction').getInstance(self),j,k,l=g.getSkillset(),m=g.getDescriptor().defaultVariableInstance.getDuration(),n,o=0,p=new Array,q=new Array,r=0,s=0,t=0,u,v=0,w,x,y,z,A,B=.1,C=.2,D=.7,E=.5;for(c=0;c<a.length;c++){q.length=0;r=0;n=a[c].getInstance(self);x=parseInt(n.getMoral());y=parseInt(n.getConfidence());z=parseInt(n.getProperty('learningCoefficient'));v=0;for(d=0;d<l.size();d++){j=l.keySet().toArray()[d];k=parseInt(l.get(j));u=parseInt(n.getSkillset().get(j));if(u<k){v+=(k-u)*m/a.length}if(u<k){w=Math.ceil((1-u/100)*10*z*m/a.length);n.setSkillset(j,parseInt(n.getSkillset(j))+w)}q.push((u-k+100)/2)}n.setProperty('totalExperienceGained',parseInt(n.getProperty('totalExperienceGained'))+v);for(d=0;d<q.length;d++){r+=q[d]}s=r/q.length*D+x*B+y*C;for(d=0;d<l.size();d++){j=l.keySet().toArray()[d];k=parseInt(l.get(j));u=parseInt(n.getSkillset().get(j));if(j==n.getProperty('wish')){A=Math.floor(Math.random()*6)+5;s+=A;if(s>100)s=100}if(j==n.getProperty('hate')){A=Math.floor(Math.random()*6)+5;s-=A;if(s<0)s=0}A=Math.random();if((s<=50||A<.33)&&j==n.getProperty('wish')){n.setProperty('wish','')}A=Math.random();if(s>50&&A<.33&&j==n.getProperty('hate')){n.setProperty('hate','')}}s=Math.round(s);p.push(s);n.setProperty('lastWorkQuality',s);if(g.getProperty('workWithLeader')=='true'){n.setProperty('numberOfWorkWithLeader',parseInt(n.getProperty('numberOfWorkWithLeader'))+1)}}for(c=0;c<p.length;c++){t+=p[c]}o=t/q.length;i.setValue(i.getValue()+(o-50)*E);if(i.getValue()>100)i.setValue(100);if(i.getValue()<0)i.getValue(0);f=parseInt(g.getProperty('salary'));if(o>=parseInt(g.getProperty('workQualityMinForBonus'))){f+=parseInt(g.getProperty('bonus'))}h.setValue(h.getValue()+f);g.setActive(false)}function checkAbsencesEnd(){var a,b,c,d=self.getGameModel(),e,f=VariableDescriptorFacade.findByName(d,'absences'),g,h=VariableDescriptorFacade.findByName(d,'resources'),i;for(a=0;a<f.items.size();a++){g=f.items.get(a).getInstance(self);if(g.getActive()==true){g.setDuration(g.getDuration()-1);if(g.duration<=0){g.setActive(false);for(b=0;b<h.items.size();b++){i=h.items.get(b).getInstance(self);for(c=0;c<i.getAssignments().size();c++){e=i.getAssignments().get(c);if(e.getTaskDescriptorId()==g.getDescriptorId()){i.setMoral(40);this.calculateTeamMotivation()}}}}}}}function checkTasksState(){var a,b,c,d=self.getGameModel(),e=VariableDescriptorFacade.findByName(d,'tasks'),f,g=VariableDescriptorFacade.findByName(d,'week').getInstance(self),h=false,i=VariableDescriptorFacade.findByName(d,'resources'),j,k,l=VariableDescriptorFacade.findByName(d,'clientsSatisfaction').getInstance(self);for(a=0;a<e.items.size();a++){h=false;f=e.items.get(a).getInstance(self);for(b=0;b<i.items.size();b++){j=i.items.get(b).getInstance(self);if(j.getActive()==true){for(c=0;c<j.getAssignments().size();c++){k=j.getAssignments().get(c);if(k.getTaskDescriptorId()==f.getDescriptorId()&&f.getActive()==true){h=true}}}}if(h||g.getValue()>=f.getProperty('appearAtWeek')&&g.getValue()<f.getProperty('disappearAtWeek')&&l.getValue()>=f.getProperty('clientSatisfactionMinToAppear')&&l.getValue()<=f.getProperty('clientSatisfactionMaxToAppear')&&f.getDuration()>0){f.setActive(true)}else{f.setActive(false)}}}function payResources(){var a,b=self.getGameModel(),c=VariableDescriptorFacade.findByName(b,'resources'),d=VariableDescriptorFacade.findByName(b,'budget'),e=d.getInstance(self),f,g=0;for(a=0;a<c.items.size();a++){f=c.items.get(a).getInstance(self);if(f.getActive()==true){g+=parseInt(f.getProperty('salary'))}}e.setValue(e.getValue()-g)}function removeDeactivatedAssignements(){var a,b,c,d=new Array,e,f=self.getGameModel(),g,h=VariableDescriptorFacade.findByName(f,'resources'),i=this.getTasksAndAbsences(),j;for(a=0;a<h.items.size();a++){d.length=0;g=h.items.get(a).getInstance(self);for(b=0;b<g.getAssignments().size();b++){e=g.getAssignments().get(b);for(c=0;c<i.length;c++){j=i[c].getInstance(self);if(e.getTaskDescriptorId()==j.getDescriptorId()&&j.getActive()==false){d.push(e)}}}for(b=0;b<d.length;b++){g.getAssignments().remove(d[b])}}}function getTasksAndAbsences(){var a,b=new Array,c=self.getGameModel(),d=VariableDescriptorFacade.findByName(c,'tasks'),e=VariableDescriptorFacade.findByName(c,'absences');for(a=0;a<d.items.size();a++){b.push(d.items.get(a))}for(a=0;a<e.items.size();a++){b.push(e.items.get(a))}return b}function checkMoral(){var a,b,c,d,e,f=false,g,h,i=self.getGameModel(),j=VariableDescriptorFacade.findByName(i,'absences'),k,l=VariableDescriptorFacade.findByName(i,'resources');for(a=0;a<l.items.size();a++){g=l.items.get(a);h=g.getInstance(self);for(b=0;b<j.items.size();b++){k=j.items.get(b).getInstance(self);if(k.getActive()==true){for(c=0;c<h.getAssignments().size();c++){if(h.getAssignments().get(c).getTaskDescriptorId()==k.getDescriptorId()){f=true}}}}if(!f){d=h.getMoral();e=Math.random();switch(true){case d<10:if(e<.33){h.active(false)}else{sickenResource(g,2)}break;case d<20:if(e<.66){sickenResource(g,2)}break;case d<30:if(e<.33){sickenResource(g,1)}break}}}}function calculateTeamMotivation(){var a,b=0,c=self.getGameModel(),d=0,e,f=VariableDescriptorFacade.findByName(c,'resources'),g=100,h=VariableDescriptorFacade.findByName(c,'teamMotivation').getInstance(self);f.items.get(0).getInstance(self).setActive(false);for(a=0;a<f.items.size();a++){if(f.items.get(a).getInstance(self).getActive()==true){e=parseInt(f.items.get(a).getInstance(self).getMoral());b+=e;d++;if(e<g)g=e}}h.value=Math.round((Math.round(b/d)+g)/2)}function checkLeadershipLevel(){var a,b=self.getGameModel(),c,d,e,f=VariableDescriptorFacade.findByName(b,'resources'),g=parseInt(VariableDescriptorFacade.findByName(b,'week').getMaxValue()),h=10*(g-1)+75,i=15*(g-1)+85;for(a=0;a<f.items.size();a++){c=f.items.get(a).getInstance(self);if(c.getActive()==true){e=parseInt(c.getConfidence())+parseInt(c.getProperty('totalExperienceGained'));switch(true){case e>=h&&e<i:d=2;break;case e>=i:d=3;break;default:d=1}c.setProperty('leadershipLevel',d)}}}function sendScore(){}function getScore(){var a=self.getGameModel(),b,c,d,e=.2,f=.45,g=.35;b=parseInt(VariableDescriptorFacade.findByName(a,'teamMotivation'));c=parseInt(VariableDescriptorFacade.findByName(a,'budget'));d=parseInt(VariableDescriptorFacade.findByName(a,'clientsSatisfaction'));return c/25*e+b*20*f+d*20*f}function sickenResource(a,b){var c,d,e,f=self.getGameModel(),g=VariableDescriptorFacade.findByName(f,'resources');for(c=0;c<g.items.size();c++){if(a==g.items.get(c).id){d=g.items.get(c).getInstance(self)}}if(d!=null){d.assign(0,e)}else{println('unknow id of resourceDescriptor in function sickenResource')}}function assignTask(a,b){var c,d,e,f,g=self.getGameModel(),h=false,i=VariableDescriptorFacade.findByName(g,'resources'),j=VariableDescriptorFacade.findByName(g,'tasks');for(c=0;c<i.items.size();c++){if(a==i.items.get(c).id){e=i.items.get(c).getInstance(self)}}for(c=0;c<j.items.size();c++){if(b==j.items.get(c).id){f=j.items.get(c)}if(e!=null){for(d=0;d<e.getAssignments().size();d++){if(e.getAssignments().get(d).getTaskDescriptorId()==f.getId()&&f.getActive()==true){h=true}}}}if(f!=null&&e!=null&&!h){e.assign(0,f)}}function lookupBean(b){var c=new InitialContext;return c.lookup('java:module/'+b);a}function sendMessage(a,b){var c=lookupBean('InGameMailFacade');if(c!=null){c.send(self,a,b)}else{println('Bean InGameMailFacade does not exist, unable to send in-game message: '+a)}}importPackage(javax.naming)"
    }
}
